<section class="detalle">
		<div class="gallery">
			<img *ngFor="let img of gallery" [src]="img" alt="foto"/>
		</div>

	<div class="content">
		<div class="main">
			<h1>{{ alojamiento?.nombre || 'Caba√±a Sierra Verde' }}</h1>
			<p class="meta">{{ alojamiento?.ubicacion || 'Arroyo Seco, Qro' }} ‚Ä¢ ‚òÖ 4.7</p>
			<p>
				{{ alojamiento?.descripcion || 'Acogedora caba√±a rodeada de naturaleza, perfecta para desconectarte y disfrutar de la sierra. A pocos minutos del r√≠o y de senderos para explorar.' }}
			</p>
			<button 
				*ngIf="alojamiento?.latitud && alojamiento?.longitud" 
				class="btn-como-llegar" 
				(click)="abrirComoLlegar()">
				üìç C√≥mo llegar
			</button>
		</div>

				<aside class="booking" *ngIf="alojamiento">
					<div class="login-aviso" *ngIf="!autenticado">
						<p>Inicia sesi√≥n para poder reservar.</p>
						<a routerLink="/login" class="btn-login-aviso">Iniciar sesi√≥n</a>
					</div>
					<div *ngIf="autenticado && !isPublic; else irCliente">
						<h3>${{ alojamiento.precioPorNoche }} <small>/ noche</small></h3>
						<form #b="ngForm" (ngSubmit)="abrirModalPago(b)">
							<mat-form-field appearance="outline">
								<mat-label>Rango de fechas</mat-label>
								<mat-date-range-input [rangePicker]="picker">
									<input matStartDate matInput name="entrada" placeholder="Entrada" [(ngModel)]="booking.entrada" required />
									<input matEndDate matInput name="salida" placeholder="Salida" [(ngModel)]="booking.salida" required />
								</mat-date-range-input>
								<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
								<mat-date-range-picker #picker [dateClass]="dateClass" [dateFilter]="dateFilter"></mat-date-range-picker>
							</mat-form-field>

							<div class="calendar-legend">
								<span class="dot"></span> Fechas en rojo: ocupadas (Confirmada)
							</div>

							<div *ngIf="booking.entrada && booking.salida && !rangoDisponible()" style="color:#b91c1c;font-weight:600">
								El rango seleccionado incluye fechas ocupadas.
							</div>

							<label>
								Hu√©spedes
								<input type="number" name="huespedes" min="1" [(ngModel)]="booking.huespedes" required>
							</label>

							<div class="total" *ngIf="total > 0">
								Total a pagar: ${{ total.toLocaleString() }} MXN
							</div>

							<button type="submit" [disabled]="b.invalid || !total || !rangoDisponible()">Reservar ahora</button>
						</form>
					</div>
					<ng-template #irCliente>
						<div *ngIf="isPublic" class="login-aviso">
							<p>Est√°s en vista p√∫blica. Para reservar debes iniciar sesi√≥n.</p>
							<a routerLink="/login" [queryParams]="{ returnUrl: '/cliente/alojamientos/' + alojamientoId }" class="btn-login-aviso">Iniciar sesi√≥n</a>
						</div>
					</ng-template>
				</aside>
	</div>
</section>

<div class="modal-backdrop" *ngIf="showPagoModal" (click)="cerrarModalPago()"></div>
<div class="modal" *ngIf="showPagoModal" (click)="$event.stopPropagation()">
	<div class="modal__header">
		<h3>Pago por transferencia</h3>
		<button class="close" (click)="cerrarModalPago()">√ó</button>
	</div>
	<div class="modal__body">
		<p>Realiza la transferencia con los siguientes datos:</p>
		<ul class="bank-data">
			<li><strong>Nombre:</strong> Arroyo Seco Tur√≠stico S.A. de C.V.</li>
			<li><strong>Banco:</strong> Banco Ejemplo</li>
			<li><strong>Cuenta/CLABE:</strong> 012345678901234567</li>
			<li><strong>Referencia:</strong> {{ alojamientoId }}-{{ total }}</li>
		</ul>

		<label class="upload">
			Comprobante (PDF/JPG/PNG)
			<input type="file" accept=".pdf,.png,.jpg,.jpeg,image/*,application/pdf" (change)="onComprobanteChange($event)" required />
		</label>
	</div>
	<div class="modal__footer">
		<button class="btn" (click)="cerrarModalPago()" [disabled]="creando">Cancelar</button>
		<button class="btn primary" (click)="confirmarReservaYComprobante()" [disabled]="!comprobanteFile || creando">
			{{ creando ? 'Procesando...' : 'Confirmar y enviar comprobante' }}
		</button>
	</div>
	</div>
